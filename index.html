<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latiao CRM PRO | Ultimate Control</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #e62117;
            --accent-glow: rgba(230, 33, 23, 0.12);
            --chrome-bg: #dfe1e5;
            --chrome-tab: #ffffff;
            --sidebar-bg: #f8f9fa;
            --border: #e8eaed;
            --glass: rgba(255, 255, 255, 0.8);
            --success: #34c759;
            --info: #007aff;
            --warning: #ffb900;
        }

        * { box-sizing: border-box; outline: none; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        body { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; background: var(--chrome-bg); color: #1a1a1b; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- CHROME TABS UI --- */
        .chrome-header { display: flex; align-items: flex-end; padding: 8px 12px 0; gap: 4px; background: var(--chrome-bg); border-bottom: 1px solid #c1c3c8; }
        .tab {
            position: relative; padding: 10px 22px; min-width: 170px; height: 38px;
            background: transparent; border-radius: 12px 12px 0 0;
            cursor: pointer; font-size: 13px; font-weight: 600; color: #5f6368;
            display: flex; align-items: center; gap: 8px;
        }
        .tab.active { background: var(--chrome-tab); color: var(--accent); }
        .tab.active::before { content: ''; position: absolute; bottom: 0; left: -20px; width: 20px; height: 20px; border-bottom-right-radius: 12px; box-shadow: 10px 0 0 0 var(--chrome-tab); }
        .tab.active::after { content: ''; position: absolute; bottom: 0; right: -20px; width: 20px; height: 20px; border-bottom-left-radius: 12px; box-shadow: -10px 0 0 0 var(--chrome-tab); }

        /* --- LAYOUT --- */
        .app-shell { flex: 1; display: flex; background: #fff; overflow: hidden; }
        .sidebar { width: 340px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .viewport { flex: 1; display: flex; flex-direction: column; background: #fff; }

        /* --- USER MANAGEMENT CARDS --- */
        .user-list-container { padding: 20px; overflow-y: auto; flex: 1; }
        .u-card { 
            background: #fff; border: 1px solid var(--border); border-radius: 20px; 
            padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            display: flex; flex-direction: column; gap: 12px;
        }
        .u-card:hover { border-color: var(--info); transform: translateY(-2px); }
        .u-header { display: flex; align-items: center; gap: 12px; }
        .u-avatar { width: 44px; height: 44px; border-radius: 14px; background: #f0f2f5; display: flex; align-items: center; justify-content: center; font-weight: 800; color: #444; font-size: 18px; }
        .u-details b { font-size: 15px; color: #1a1a1a; display: block; }
        .u-details span { font-size: 11px; color: var(--success); font-weight: 700; text-transform: uppercase; }
        
        .u-actions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .act-btn { border: none; padding: 10px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: 0.2s; }
        .act-btn.private { background: var(--accent-glow); color: var(--accent); }
        .act-btn.phone { background: rgba(0, 122, 255, 0.1); color: var(--info); }
        .act-btn.ban { background: #f0f2f5; color: #333; }
        .act-btn:hover { transform: scale(1.05); filter: brightness(0.95); }

        /* --- MESSAGING & ADS --- */
        .msg-area { flex: 1; padding: 25px; overflow-y: auto; background: #f4f6f8; display: flex; flex-direction: column; gap: 10px; }
        .bubble { padding: 12px 18px; border-radius: 20px; max-width: 75%; font-size: 14px; position: relative; line-height: 1.5; }
        .bubble.in { align-self: flex-start; background: #fff; color: #1a1a1a; border-bottom-left-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .bubble.out { align-self: flex-end; background: var(--accent); color: #fff; border-bottom-right-radius: 4px; box-shadow: 0 4px 12px var(--accent-glow); }
        .msg-info { font-size: 9px; opacity: 0.6; margin-bottom: 4px; display: block; }

        .control-panel { padding: 20px; background: #fff; border-top: 1px solid var(--border); }
        .tool-grid { display: grid; grid-template-columns: 1fr 300px; gap: 20px; height: 100%; }
        
        /* AD Planner */
        .ad-box { background: #f8f9fa; padding: 20px; border-radius: 24px; border: 1px solid var(--border); }
        .input-dark { width: 100%; padding: 12px 16px; border-radius: 12px; border: 1px solid #ddd; background: #fff; font-size: 14px; margin-bottom: 10px; }
        .btn-black { background: #000; color: #fff; border: none; padding: 12px 24px; border-radius: 14px; font-weight: 700; cursor: pointer; width: 100%; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .u-card { animation: fadeIn 0.4s ease forwards; }
    </style>
</head>
<body>

    <header class="chrome-header">
        <div class="tab active" onclick="nav('support', this)"><span>üí¨ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞</span></div>
        <div class="tab" onclick="nav('community', this)"><span>üå∂Ô∏è –°–ø—ñ–ª—å–Ω–æ—Ç–∞</span></div>
        <div class="tab" onclick="nav('settings', this)"><span>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</span></div>
        <div style="flex:1"></div>
        <div style="font-size:11px; font-weight:800; color:#aaa; padding-bottom:10px;">LATIAO CRM ULTIMATE</div>
    </header>

    <div class="app-shell">
        
        <aside class="sidebar" id="side-panel">
            <div style="padding: 20px; border-bottom: 1px solid var(--border); font-weight: 800; font-size: 13px; color: #888;">–ê–ö–¢–ò–í–ù–Ü –î–Ü–ê–õ–û–ì–ò</div>
            <div class="chat-list-container" id="support-chat-list" style="flex:1; overflow-y:auto; padding:10px;"></div>
        </aside>

        <main class="viewport view-tab active" id="view-support">
            <div style="padding:15px 25px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center">
                <b id="active-chat-name" style="font-size:16px">–û–±–µ—Ä—ñ—Ç—å —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏</b>
                <button class="btn-black" style="width:auto; padding:8px 15px; font-size:12px;" onclick="closeSupport()">–ê—Ä—Ö—ñ–≤—É–≤–∞—Ç–∏</button>
            </div>
            <div class="msg-area" id="support-msgs"></div>
            <form class="control-panel" style="display:flex; gap:10px;" onsubmit="sendSupport(event)">
                <input type="text" id="support-in" class="input-dark" style="margin:0; border-radius:30px" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å –∫–ª—ñ—î–Ω—Ç—É...">
                <button type="submit" class="btn-black" style="width:50px; height:50px; border-radius:50%; padding:0">‚û§</button>
            </form>
        </main>

        <main class="viewport view-tab" id="view-community" style="display:none">
            <div class="tool-grid">
                <div style="display:flex; flex-direction:column; border-right:1px solid var(--border)">
                    <div style="padding:15px 25px; border-bottom:1px solid var(--border); font-weight:800">–ú–û–ù–Ü–¢–û–†–ò–ù–ì –°–ü–Ü–õ–¨–ù–û–¢–ò</div>
                    <div class="msg-area" id="comm-msgs"></div>
                    <form class="control-panel" style="display:flex; gap:10px" onsubmit="sendComm(event)">
                        <input type="text" id="comm-in" class="input-dark" style="margin:0" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É —á–∞—Ç –≤—ñ–¥ —ñ–º–µ–Ω—ñ SHOP...">
                        <button type="submit" class="btn-black" style="width:auto">–ù–ê–î–Ü–°–õ–ê–¢–ò</button>
                    </form>
                </div>
                
                <div style="padding:20px; overflow-y:auto; background:#fdfdfd">
                    <div class="ad-box">
                        <label style="color:var(--accent); font-weight:800; font-size:12px; display:block; margin-bottom:15px">üì¢ –ö–ï–†–£–í–ê–ù–ù–Ø –†–ï–ö–õ–ê–ú–û–Æ</label>
                        <textarea id="ad-text" class="input-dark" placeholder="–¢–µ–∫—Å—Ç –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è..."></textarea>
                        <input type="text" id="ad-img" class="input-dark" placeholder="URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è">
                        <div style="display:flex; gap:10px">
                            <input type="number" id="ad-count" class="input-dark" value="1" title="–ü–æ–∫–∞–∑—ñ–≤">
                            <input type="number" id="ad-interval" class="input-dark" value="30" title="–Ü–Ω—Ç–µ—Ä–≤–∞–ª (—Ö–≤)">
                        </div>
                        <button class="btn-black" style="background:var(--accent)" onclick="startAd()">–ó–ê–ü–£–°–¢–ò–¢–ò –ü–£–®</button>
                    </div>

                    <div style="margin-top:25px">
                        <label style="font-weight:800; font-size:11px; color:#888; display:block; margin-bottom:15px">–ö–û–†–ò–°–¢–£–í–ê–ß–Ü –í –û–ù–õ–ê–ô–ù–Ü</label>
                        <div id="comm-user-cards"></div>
                    </div>
                </div>
            </div>
        </main>

    </div>

<script>
    // --- Firebase Logic ---
    const firebaseConfig = { databaseURL: "https://latiao-chat-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let curSId = null;
    let adIntervalId = null;

    function nav(tab, el) {
        document.querySelectorAll('.view-tab').forEach(v => v.style.display = 'none');
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('view-' + tab).style.display = (tab === 'community' ? 'block' : 'flex');
        el.classList.add('active');
        document.getElementById('side-panel').style.display = (tab === 'support') ? 'flex' : 'none';
    }

    // --- Support logic ---
    db.ref('active_chats').on('value', snap => {
        const list = document.getElementById('support-chat-list');
        list.innerHTML = '';
        snap.forEach(c => {
            const div = document.createElement('div');
            div.style = `padding:15px; border-radius:15px; margin-bottom:8px; cursor:pointer; background:${curSId === c.key ? 'var(--accent-glow)' : '#fff'}; border:1px solid ${curSId === c.key ? 'var(--accent)' : '#eee'}`;
            div.innerHTML = `<b>üë§ ${c.key.substring(1,9)}</b><br><small style="color:#888">${c.val().lastMsg || '...'}</small>`;
            div.onclick = () => selectS(c.key);
            list.appendChild(div);
        });
    });

    function selectS(id) {
        curSId = id;
        document.getElementById('active-chat-name').innerText = "–ö–ª—ñ—î–Ω—Ç: " + id;
        db.ref('support/' + id).on('value', snap => {
            const area = document.getElementById('support-msgs');
            area.innerHTML = '';
            snap.forEach(m => {
                const d = m.val();
                const div = document.createElement('div');
                div.className = `bubble ${d.type === 'admin' ? 'out' : 'in'}`;
                div.innerText = d.text;
                area.appendChild(div);
            });
            area.scrollTop = area.scrollHeight;
        });
    }

    function sendSupport(e) {
        e.preventDefault();
        const input = document.getElementById('support-in');
        if(!curSId || !input.value) return;
        db.ref('support/' + curSId).push({ text: input.value, type: 'admin', ts: Date.now() });
        db.ref('active_chats/' + curSId).update({ lastMsg: "–í–∏: " + input.value, ts: Date.now() });
        input.value = '';
    }

    // --- Community logic ---
    db.ref('messages').limitToLast(40).on('value', snap => {
        const area = document.getElementById('comm-msgs');
        area.innerHTML = '';
        snap.forEach(c => {
            const m = c.val();
            const div = document.createElement('div');
            div.className = `bubble ${m.uid === 'SHOP' ? 'out' : 'in'}`;
            div.style.alignSelf = m.uid === 'SHOP' ? 'flex-end' : 'flex-start';
            div.innerHTML = `<span class="msg-info">${m.name}</span>${m.text}`;
            area.appendChild(div);
        });
        area.scrollTop = area.scrollHeight;
    });

    db.ref('presence').on('value', snap => {
        const container = document.getElementById('comm-user-cards');
        container.innerHTML = '';
        snap.forEach(c => {
            const u = c.val();
            const char = (u.name || "?")[0];
            const card = document.createElement('div');
            card.className = 'u-card';
            card.innerHTML = `
                <div class="u-header">
                    <div class="u-avatar">${char}</div>
                    <div class="u-details">
                        <b>${u.name || "–ì—ñ—Å—Ç—å"}</b>
                        <span>${u.phone ? '‚úì –í–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π' : '–û–Ω–ª–∞–π–Ω'}</span>
                    </div>
                </div>
                <div class="u-actions">
                    <button class="act-btn private" onclick="uAct('${c.key}', 'msg')" title="–ü—Ä–∏–≤–∞—Ç">‚úâÔ∏è</button>
                    <button class="act-btn phone" onclick="uAct('${c.key}', 'phone')" title="–ó–∞–ø–∏—Ç —Ç–µ–ª–µ—Ñ–æ–Ω—É">üì±</button>
                    <button class="act-btn ban" onclick="uAct('${c.key}', 'ban')" title="–ó–∞–±–∞–Ω–∏—Ç–∏">üö´</button>
                </div>`;
            container.appendChild(card);
        });
    });

    function uAct(uid, type) {
        if(type === 'msg') {
            const t = prompt("–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –æ—Å–æ–±–∏—Å—Ç–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:");
            if(t) db.ref('private_messages/' + uid).push({ text: t, ts: Date.now() });
        }
        if(type === 'phone') {
            if(confirm("–ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ —á–∞—Ç –¥–ª—è —é–∑–µ—Ä–∞ –¥–æ –≤–≤–µ–¥–µ–Ω–Ω—è —Ç–µ–ª–µ—Ñ–æ–Ω—É?")) {
                db.ref('presence/' + uid).update({ requirePhone: true, phoneProvided: false });
            }
        }
        if(type === 'ban') {
            if(confirm("–ó–∞–±–∞–Ω–∏—Ç–∏ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞–∑–∞–≤–∂–¥–∏?")) {
                db.ref('banned_users/' + uid).set({ ts: Date.now() });
            }
        }
    }

    function sendComm(e) {
        e.preventDefault();
        const v = document.getElementById('comm-in').value;
        if(v) db.ref('messages').push({ uid: 'SHOP', name: 'SHOP ADMIN', text: v, ts: Date.now() });
        document.getElementById('comm-in').value = '';
    }

    function startAd() {
        const text = document.getElementById('ad-text').value;
        const img = document.getElementById('ad-img').value;
        const count = parseInt(document.getElementById('ad-count').value);
        const interval = parseInt(document.getElementById('ad-interval').value) * 60000;
        if(!text) return;

        let sent = 0;
        const run = () => {
            if(sent < count) {
                db.ref('messages').push({ uid: 'SHOP', name: 'üõçÔ∏è Latiao PROMO', text, img, ts: Date.now() });
                sent++;
                if(sent < count) setTimeout(run, interval);
            }
        };
        run();
        alert("–†–µ–∫–ª–∞–º–Ω—É –∫–∞–º–ø–∞–Ω—ñ—é –∑–∞–ø—É—â–µ–Ω–æ!");
    }

    function closeSupport() {
        if(!curSId) return;
        db.ref('support/' + curSId).once('value', snap => {
            db.ref('archive/' + curSId).set(snap.val());
            db.ref('closed_chats/' + curSId).set({ ts: Date.now(), lastMsg: "–ó–∞–∫—Ä–∏—Ç–æ" });
            db.ref('support/' + curSId).remove();
            db.ref('active_chats/' + curSId).remove();
            curSId = null;
            document.getElementById('support-msgs').innerHTML = '';
        });
    }
</script>
</body>
</html>
