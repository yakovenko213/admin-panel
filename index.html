<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latiao Ultra CRM 2025</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #e62117;
            --accent-soft: rgba(230, 33, 23, 0.08);
            --chrome-bg: #dee1e6;
            --chrome-tab: #ffffff;
            --sidebar-bg: #f7f9fc;
            --border: #e0e4e9;
            --text-primary: #1a1d21;
            --text-secondary: #5f6368;
        }

        * { box-sizing: border-box; outline: none; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; background: var(--chrome-bg); color: var(--text-primary); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- CHROME TABS STYLE --- */
        .chrome-tabs-container {
            display: flex; align-items: flex-end; padding: 8px 8px 0 8px; gap: 4px; background: var(--chrome-bg);
        }
        .chrome-tab {
            position: relative; padding: 10px 25px; min-width: 180px; height: 38px;
            background: transparent; border-radius: 10px 10px 0 0;
            cursor: pointer; font-size: 13px; font-weight: 500; color: var(--text-secondary);
            display: flex; align-items: center; gap: 8px; transition: 0.2s;
        }
        .chrome-tab:hover { background: rgba(255,255,255,0.4); }
        .chrome-tab.active {
            background: var(--chrome-tab); color: var(--accent); font-weight: 600;
        }
        /* –ï—Ñ–µ–∫—Ç –∑–∞–∫—Ä—É–≥–ª–µ–Ω–Ω—è –∫—É—Ç—ñ–≤ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—ó –≤–∫–ª–∞–¥–∫–∏ (Chrome —Å—Ç–∏–ª—å) */
        .chrome-tab.active::before, .chrome-tab.active::after {
            content: ''; position: absolute; bottom: 0; width: 20px; height: 20px; background: transparent;
        }
        .chrome-tab.active::before { left: -20px; border-bottom-right-radius: 12px; box-shadow: 10px 0 0 0 var(--chrome-tab); }
        .chrome-tab.active::after { right: -20px; border-bottom-left-radius: 12px; box-shadow: -10px 0 0 0 var(--chrome-tab); }

        /* --- MAIN LAYOUT --- */
        .app-window { flex: 1; display: flex; background: var(--chrome-tab); position: relative; z-index: 10; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 320px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .sidebar-header h3 { margin: 0; font-size: 16px; color: var(--accent); }

        .chat-list { flex: 1; overflow-y: auto; padding: 8px; }
        .chat-card {
            padding: 12px 16px; border-radius: 12px; cursor: pointer; margin-bottom: 4px; transition: 0.2s;
            border: 1px solid transparent;
        }
        .chat-card:hover { background: #edf1f7; }
        .chat-card.active { background: var(--accent-soft); border-color: rgba(230,33,23,0.1); }
        .chat-card strong { display: block; font-size: 14px; margin-bottom: 4px; }
        .chat-card small { color: var(--text-secondary); font-size: 12px; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* Workspace */
        .workspace { flex: 1; display: flex; flex-direction: column; background: #fff; }
        .workspace-header { padding: 15px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        
        .messages-area { flex: 1; padding: 25px; overflow-y: auto; background: #fdfdfe; display: flex; flex-direction: column; gap: 12px; }
        .bubble { padding: 10px 16px; border-radius: 16px; max-width: 70%; font-size: 14px; line-height: 1.5; }
        .bubble.user { align-self: flex-start; background: #f1f3f4; color: var(--text-primary); border-bottom-left-radius: 4px; }
        .bubble.admin { align-self: flex-end; background: var(--accent); color: #fff; border-bottom-right-radius: 4px; box-shadow: 0 4px 12px rgba(230,33,23,0.2); }

        .input-bar { padding: 15px 25px; border-top: 1px solid var(--border); display: flex; gap: 12px; background: #fff; }
        .input-bar input { flex: 1; padding: 12px 20px; border-radius: 20px; border: 1px solid var(--border); background: #f8f9fa; transition: 0.2s; }
        .input-bar input:focus { border-color: var(--accent); background: #fff; }

        /* Tools for Community */
        .community-tools { width: 340px; border-left: 1px solid var(--border); background: var(--sidebar-bg); padding: 20px; overflow-y: auto; }
        .tool-card { background: #fff; border-radius: 16px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--border); }
        .tool-card h4 { margin: 0 0 12px 0; font-size: 12px; text-transform: uppercase; color: var(--text-secondary); letter-spacing: 0.5px; }

        .btn-main { background: var(--accent); color: white; border: none; padding: 10px 18px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 13px; transition: 0.2s; }
        .btn-main:hover { opacity: 0.9; transform: translateY(-1px); }

        .user-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
        .status-dot { width: 8px; height: 8px; background: #34c759; border-radius: 50%; display: inline-block; margin-right: 5px; }

        /* Auth */
        #auth-gate { position: fixed; inset: 0; background: #fff; z-index: 99999; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div class="chrome-tabs-container">
        <div class="chrome-tab active" onclick="switchMainTab('support', this)">
            <span>üí¨ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞</span>
        </div>
        <div class="chrome-tab" onclick="switchMainTab('community', this)">
            <span>üå∂Ô∏è –°–ø—ñ–ª—å–Ω–æ—Ç–∞</span>
        </div>
        <div class="chrome-tab" onclick="switchMainTab('stats', this)">
            <span>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
        </div>
        <div style="flex: 1;"></div>
        <div style="padding-bottom: 8px; padding-right: 15px; font-size: 12px; color: #888;">Latiao Admin v2.5</div>
    </div>

    <div class="app-window">
        
        <aside class="sidebar" id="sidebar-panel">
            <div class="sidebar-header">
                <h3>–î—ñ–∞–ª–æ–≥–∏</h3>
                <div id="online-count" style="font-size: 10px; background: #eee; padding: 2px 6px; border-radius: 10px;">0</div>
            </div>
            <div class="chat-list" id="chat-list-data">
                </div>
        </aside>

        <main class="workspace tab-view active" id="view-support">
            <div class="workspace-header">
                <b id="active-user-name">–û–±–µ—Ä—ñ—Ç—å —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏</b>
                <button class="btn-main" style="background: #333;" onclick="archiveChat()">–í –∞—Ä—Ö—ñ–≤</button>
            </div>
            <div class="messages-area" id="support-msgs"></div>
            <form class="input-bar" onsubmit="sendSupport(event)">
                <input type="text" id="support-input" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –∫–ª—ñ—î–Ω—Ç—É...">
                <button type="submit" class="btn-main">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
            </form>
        </main>

        <main class="workspace tab-view" id="view-community" style="display:none; flex-direction: row;">
            <div style="flex: 1; display: flex; flex-direction: column;">
                <div class="workspace-header"><b>–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —á–∞—Ç—É –∫–ª—É–±—É</b></div>
                <div class="messages-area" id="community-msgs"></div>
                <form class="input-bar" onsubmit="sendCommunity(event)">
                    <input type="text" id="community-input" placeholder="–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —É —Å–ø—ñ–ª—å–Ω–æ—Ç—É —è–∫ SHOP...">
                    <button type="submit" class="btn-main" style="background: #000;">OK</button>
                </form>
            </div>
            <aside class="community-tools">
                <div class="tool-card">
                    <h4>üì¢ –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</h4>
                    <input type="text" id="ad-url" placeholder="URL —Ñ–æ—Ç–æ" style="width:100%; margin-bottom:8px; padding:8px; border-radius:8px; border:1px solid #ddd;">
                    <textarea id="ad-txt" placeholder="–¢–µ–∫—Å—Ç –∞–∫—Ü—ñ—ó..." style="width:100%; height:60px; padding:8px; border-radius:8px; border:1px solid #ddd;"></textarea>
                    <button class="btn-main" style="width:100%; margin-top:10px;" onclick="pushAd()">–ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ä–µ–∫–ª–∞–º—É</button>
                </div>
                <div class="tool-card">
                    <h4>üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ–Ω–ª–∞–π–Ω</h4>
                    <div id="online-users-list"></div>
                </div>
                <div class="tool-card">
                    <h4>üìä –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è</h4>
                    <input type="text" id="poll-val" placeholder="–ü–∏—Ç–∞–Ω–Ω—è..." style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
                    <button class="btn-main" style="width:100%; margin-top:10px; background: #673ab7;" onclick="pushPoll()">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
                </div>
            </aside>
        </main>

    </div>

    <div id="auth-gate">
        <div style="text-align:center; width: 300px; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            <h2 style="color: var(--accent);">–í—Ö—ñ–¥</h2>
            <input type="password" id="gate-pass" placeholder="–ü–∞—Ä–æ–ª—å" style="width:100%; padding:12px; border-radius:10px; border:1px solid #ddd; margin-bottom:15px;">
            <button class="btn-main" style="width:100%;" onclick="checkGate()">–£–≤—ñ–π—Ç–∏</button>
        </div>
    </div>

<script>
    const firebaseConfig = { databaseURL: "https://latiao-chat-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function checkGate() {
        if(document.getElementById('gate-pass').value === 'latiao2025') {
            document.getElementById('auth-gate').style.display = 'none';
            initCRM();
        }
    }

    function switchMainTab(view, el) {
        document.querySelectorAll('.tab-view').forEach(v => v.style.display = 'none');
        document.querySelectorAll('.chrome-tab').forEach(t => t.classList.remove('active'));
        
        if(view === 'support') document.getElementById('view-support').style.display = 'flex';
        if(view === 'community') document.getElementById('view-community').style.display = 'flex';
        
        el.classList.add('active');
        document.getElementById('sidebar-panel').style.display = (view === 'support') ? 'flex' : 'none';
    }

    let activeSupportId = null;

    function initCRM() {
        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –ø—ñ–¥—Ç—Ä–∏–º–∫–∏
        db.ref('active_chats').on('value', snap => {
            const list = document.getElementById('chat-list-data');
            list.innerHTML = '';
            snap.forEach(child => {
                const div = document.createElement('div');
                div.className = `chat-card ${activeSupportId === child.key ? 'active' : ''}`;
                div.innerHTML = `<strong>üë§ ${child.key.substring(0,10)}</strong><small>${child.val().lastMsg || '–ù–æ–≤–∏–π –¥—ñ–∞–ª–æ–≥'}</small>`;
                div.onclick = () => selectSupport(child.key);
                list.appendChild(div);
            });
        });

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø—ñ–ª—å–Ω–æ—Ç–∏
        db.ref('messages').limitToLast(40).on('value', snap => {
            const area = document.getElementById('community-msgs');
            area.innerHTML = '';
            snap.forEach(c => {
                const m = c.val();
                const div = document.createElement('div');
                div.className = `bubble ${m.uid === 'SHOP' ? 'admin' : 'user'}`;
                div.innerHTML = `<small style="display:block;font-size:9px;opacity:0.6">${m.name}</small>${m.text}`;
                area.appendChild(div);
            });
            area.scrollTop = area.scrollHeight;
        });

        // –Æ–∑–µ—Ä–∏ –æ–Ω–ª–∞–π–Ω
        db.ref('presence').on('value', snap => {
            const list = document.getElementById('online-users-list');
            const count = document.getElementById('online-count');
            list.innerHTML = '';
            let i = 0;
            snap.forEach(child => {
                i++;
                const u = child.val();
                list.innerHTML += `<div class="user-row">
                    <span><span class="status-dot"></span>${u.name}</span>
                    <button class="btn-main" style="padding:4px 8px; font-size:9px;" onclick="adminAction('${child.key}')">–î—ñ—è</button>
                </div>`;
            });
            count.innerText = i;
        });
    }

    function selectSupport(id) {
        activeSupportId = id;
        document.getElementById('active-user-name').innerText = "–î—ñ–∞–ª–æ–≥: " + id;
        db.ref('support/' + id).on('value', snap => {
            const area = document.getElementById('support-msgs');
            area.innerHTML = '';
            snap.forEach(child => {
                const m = child.val();
                const div = document.createElement('div');
                div.className = 'bubble ' + (m.type === 'admin' ? 'admin' : 'user');
                div.innerText = m.text;
                area.appendChild(div);
            });
            area.scrollTop = area.scrollHeight;
        });
    }

    function sendSupport(e) {
        e.preventDefault();
        const input = document.getElementById('support-input');
        if(!activeSupportId || !input.value) return;
        db.ref('support/' + activeSupportId).push({ text: input.value, type: 'admin', ts: Date.now() });
        db.ref('active_chats/' + activeSupportId).update({ lastMsg: "–í–∏: " + input.value, ts: Date.now() });
        input.value = '';
    }

    function sendCommunity(e) {
        e.preventDefault();
        const input = document.getElementById('community-input');
        if(!input.value) return;
        db.ref('messages').push({ uid: 'SHOP', name: 'ADMIN', text: input.value, ts: Date.now() });
        input.value = '';
    }

    function pushAd() {
        const text = document.getElementById('ad-txt').value;
        const img = document.getElementById('ad-url').value;
        if(text) db.ref('messages').push({ uid: 'SHOP', name: 'üõçÔ∏è Latiao PROMO', text: text, img: img, ts: Date.now() });
    }

    window.adminAction = (uid) => {
        const act = prompt("1: –ü—Ä–∏–≤–∞—Ç, 2: –ó–∞–ø–∏—Ç ‚Ññ, 3: –ë–∞–Ω");
        if(act == "1") {
            const m = prompt("–¢–µ–∫—Å—Ç:");
            db.ref('private_messages/' + uid).push({ text: m, ts: Date.now() });
        }
        if(act == "2") db.ref('presence/' + uid).update({ requirePhone: true });
        if(act == "3") db.ref('banned_users/' + uid).set({ ts: Date.now() });
    };
</script>
</body>
</html>
